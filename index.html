<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title id="treding2"></title>
    <link
      rel="stylesheet"
      href="https://cdn.datatables.net/1.13.5/css/jquery.dataTables.min.css"
    />
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://momentjs.com/downloads/moment.js"></script>
    <style>
      th,
      td {
        border: 1px solid black;
        padding: 8px;
      }
    </style>
  </head>
  <body>
    <div class="m-3">
      <div class="border border-black w-1/4 mb-2 p-2">
        <h1 class="text-[32px] font-extrabold my-[21.44px]">Traders</h1>
        <div class="text-[25px] font-extrabold flex gap-1 items-center">
          <img
            src="assets/btc.png"
            alt="BitCoinLogo"
            class="h-[25px] w-[25px]"
          />BitCoin Price
          <span class="text-gray-500 font-normal text-[20px]">(BTC)</span>
        </div>
        <div
          id="treding"
          class="p-5 w-1/5 flex font-semibold gap-[5px] text-[16px]"
        ></div>
      </div>
      <div class="mb-2 p-2 flex gap-2">
        <input
          type="text"
          id="searchInput"
          placeholder="Enter Amount"
          value="0"
          class="outline-none border border-gray-500 p-1 rounded"
        />
      </div>
      <div class="h-full">
        <table id="myTable">
          <thead>
            <tr>
              <th class="">Price (USDT)</th>
              <th class="">Amount (BTC)</th>
              <th class="">Time</th>
            </tr>
          </thead>
          <tbody id="tableBody"></tbody>
        </table>
      </div>
      <form>
        <input type="text" />
      </form>
    </div>
  </body>
  <script src="https://code.jquery.com/jquery-3.7.0.js"></script>
  <script src="https://cdn.datatables.net/1.13.5/js/jquery.dataTables.min.js"></script>
  <script>
    var exampleSocket = new WebSocket(
      "wss://stream.binance.com:9443/ws/btcusdt@trade"
    );

    var tradeDiv = document.getElementById("treding");

    var tradeTitle = document.getElementById("treding2");

    var currentPrice = 0;
    var traders = [];
    const tableBody = document.getElementById("tableBody");
    const maxRows = 50;

    exampleSocket.onmessage = function (event) {
      var amountAbove = document.getElementById("searchInput").value;

      var oriPrice = JSON.parse(event.data);
      newrPrice = parseFloat(oriPrice.p).toFixed(2);

      tradeDiv.innerHTML = `<div class='text-black'>$</div>${newrPrice}`;

      tradeTitle.innerHTML = newrPrice;

      if (newrPrice > currentPrice) {
        document.getElementById("treding").style.color = "green";
      } else if (newrPrice < currentPrice) {
        document.getElementById("treding").style.color = "red";
      }

      currentPrice = newrPrice;

      var colors = oriPrice.m;

      var qty = oriPrice.q;

      if (qty > amountAbove) {
        document.getElementById("tableBody").innerHTML = "";

        traders.unshift([newrPrice, qty, oriPrice.T, colors]);

        if (traders.length >= 50) {
          traders = traders.slice(0, 50);
        }

        for (let i = 0; i < traders.length; ++i) {
          const row = document.createElement("tr");
          const cell1 = document.createElement("td");
          const cell2 = document.createElement("td");
          const cell3 = document.createElement("td");

          if (traders[i][3]) {
            cell1.style.color = "green";
          } else {
            cell1.style.color = "red";
          }

          cell1.textContent = traders[i][0];
          cell2.textContent = traders[i][1];
          var time = moment(traders[i][2]).startOf("seconds").fromNow();
          cell3.textContent = time;

          row.appendChild(cell1);
          row.appendChild(cell2);
          row.appendChild(cell3);

          tableBody.appendChild(row);
        }
      }
    };
  </script>
</html>
